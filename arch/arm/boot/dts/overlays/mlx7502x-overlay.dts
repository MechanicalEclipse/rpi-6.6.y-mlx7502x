// SPDX-License-Identifier: GPL-2.0-only
// DESCRIPTION
/dts-v1/;
/plugin/;

#include <dt-bindings/gpio/gpio.h>

/{

	i2c_frag: fragment@0 {
		target = <&i2c_csi_dsi>;
		__overlay__ {
			#address-cells = <1>;
			#size-cells = <0>;

			mlx7502x: camera@57 {
				compatible = "melexis,mlx75027";
				reg = <0x57>;
				clocks = <&mlx7502x_clk>;

				vdda-supply = <&cam3_reg>;
				vddif-supply = <&cam2_reg>;
				vddd-supply = <&cam1_reg>;
				vdmix-supply = <&cam1_reg>;

				rotation = <0>;
				orientation = <2>;

				port {
					mlx7502x_out_mipi_csi2: endpoint {
						remote-endpoint = <&csi1_ep>;
						clock-lanes = <0>;
						data-lanes = <1 2>;
						clock-noncontinuous;
						link-frequencies = /bits/ 64 < 960000000
														904000000
														800000000
														704000000
														600000000
														300000000 >;
					};
				};
			};
		};
	};

	csi_frag: fragment@1 {
		target = <&csi1>;
		csi: __overlay__ {
			status = "okay";

			port{
				csi1_ep: endpoint{
					remote-endpoint = <&mlx7502x_out_mipi_csi2>;
					clock-lanes = <0>;
					data-lanes = <1 2 3 4>;
				};
			};
		};
	};

	fragment@2 {
		target = <&i2c0if>;
		__overlay__ {
			status = "okay";
		};
	};

	fragment@3 {
		target = <&cam1_clk>;
		__overlay__ {
			clock-frequency = <8000000>;
			status = "okay";
		};
	};

	fragment@4 {
		target = <&i2c0mux>;
		__overlay__ {
			status = "okay";
		};
	};

	fragment@5 {
		target-path = "/";
		__overlay__ {
			cam1_reg: cam1_regulator {
					compatible = "regulator-fixed";
					regulator-name = "cam1-reg";
					enable-active-high;
				    gpio = <&gpio 4 GPIO_ACTIVE_HIGH>;
				};

			cam2_reg: cam2_regulator {
					compatible = "regulator-fixed";
					regulator-name = "cam2-reg";
					enable-active-high;
					gpio = <&gpio 3 GPIO_ACTIVE_HIGH>;
				};

			cam3_reg: cam3_regulator {
					compatible = "regulator-fixed";
					regulator-name = "cam3-reg";
					enable-active-high;
					gpio = <&gpio 2 GPIO_ACTIVE_HIGH>;
				};

			mlx7502x_clk: clk {
				compatible = "fixed-clock";
				#clock-cells = <0>;
				clock-frequency = <8000000>;
		    };
	    };
	};

	__overrides__ {
		rotation = <&mlx7502x>,"rotation:0";
		orientation = <&mlx7502x>,"orientation:0";
		media-controller = <&csi>,"brcm,media-controller?";
	};

};